<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Monkey Island: The Forbidden Temple</title>
    <style>
        body { margin: 0; background: black; overflow: hidden; }
        canvas { display: block; margin: auto; background: #111; }
        #ui { position: absolute; top: 10px; left: 10px; color: yellow; font-family: monospace; }
    </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="ui">Bananas: 0 | Moves: 0 | Time: 0s</div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const tileSize = 32;
let bananas = 0, moves = 0, seconds = 0;
let maze, playerX = 1, playerY = 1, monsterX = 2, monsterY = 2;
const completedTrials = new Set();

const assets = {};
const assetNames = ['floor', 'wall', 'lava', 'banana', 'monkey', 'monster', 'door', 'hole'];
let keys = {};

function loadAssets(callback) {
    let loaded = 0;
    assetNames.forEach(name => {
        const img = new Image();
        img.src = `${name}.png`;
        img.onload = () => {
            assets[name] = img;
            loaded++;
            if (loaded === assetNames.length) callback();
        };
    });
}

function createMaze() {
    return [
        "####################",
        "#1 B   L        B  #",
        "# ##L## # ####### #",
        "# L    # # B   #  #",
        "# #B#L # # # # # #",
        "# # # #L   #      #",
        "#B  # # #L####### #",
        "# #              #",
        "# ######L####### #",
        "#   B         O   #",
        "# #L########## ###",
        "# #     B   #     #",
        "# # ##L###########",
        "# #L   #  B   #   #",
        "# # # # L B B #   #",
        "# # # #     B     #",
        "# #   ###### #####",
        "# #B    O  L     #",
        "# L ########## ###",
        "#2 B             S#",
        "####################",
    ].map(row => row.split(''));
}

function drawMaze() {
    for (let y = 0; y < maze.length; y++) {
        for (let x = 0; x < maze[y].length; x++) {
            let tile = maze[y][x];
            let img = assets['floor'];
            if (tile === '#') img = assets['wall'];
            else if (tile === 'L') img = assets['lava'];
            else if (tile === 'B') img = assets['banana'];
            else if (tile === 'O') img = assets['hole'];
            else if ('1234'.includes(tile)) img = assets['door'];
            ctx.drawImage(img, x * tileSize, y * tileSize, tileSize, tileSize);
        }
    }
    ctx.drawImage(assets['monkey'], playerX * tileSize, playerY * tileSize, tileSize, tileSize);
    ctx.drawImage(assets['monster'], monsterX * tileSize, monsterY * tileSize, tileSize, tileSize);
}

function updateUI() {
    document.getElementById('ui').innerText = `Bananas: ${bananas} | Moves: ${moves} | Time: ${seconds}s`;
}

function movePlayer(dx, dy) {
    const newX = playerX + dx;
    const newY = playerY + dy;
    if (maze[newY][newX] !== '#') {
        playerX = newX;
        playerY = newY;
        moves++;
        let current = maze[playerY][playerX];
        if (current === 'B') {
            bananas++;
            maze[playerY][playerX] = ' ';
        }
        if (current === 'L') gameOver();
        if (current === 'S') win();
    }
}

function gameOver() {
    alert("Game Over!");
    location.reload();
}

function win() {
    alert("You win! Final Score: " + (1500 - moves - seconds + bananas * 30));
    location.reload();
}

function tick() {
    seconds++;
    updateUI();
}

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawMaze();
    requestAnimationFrame(gameLoop);
}

document.addEventListener('keydown', e => {
    if (e.key === 'ArrowUp') movePlayer(0, -1);
    else if (e.key === 'ArrowDown') movePlayer(0, 1);
    else if (e.key === 'ArrowLeft') movePlayer(-1, 0);
    else if (e.key === 'ArrowRight') movePlayer(1, 0);
});

loadAssets(() => {
    maze = createMaze();
    updateUI();
    setInterval(tick, 1000);
    gameLoop();
});
</script>
</body>
</html>
